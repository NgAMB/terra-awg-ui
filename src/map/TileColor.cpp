#include "TileColor.h"

#include "World.h"
#include "ids/Paint.h"
#include "ids/WallID.h"
#include <cstring>

namespace
{
// clang-format off
uint8_t tileColors[] = {
    151, 107, 75, 128, 128, 128, 28, 216, 94, 27, 197, 109, 253, 221, 3, 151,
    107, 75, 140, 101, 80, 150, 67, 22, 185, 164, 23, 185, 194, 195, 119, 105,
    79, 119, 105, 79, 174, 24, 69, 133, 213, 247, 191, 142, 111, 191, 142, 111,
    140, 130, 116, 144, 148, 144, 191, 142, 111, 191, 142, 111, 163, 116, 81,
    233, 207, 94, 98, 95, 167, 141, 137, 223, 122, 116, 218, 109, 90, 128, 119,
    101, 125, 226, 196, 49, 151, 79, 80, 175, 105, 128, 170, 120, 84, 141, 120,
    168, 151, 135, 183, 253, 221, 3, 235, 166, 135, 197, 216, 219, 230, 89, 92,
    104, 86, 84, 144, 144, 144, 181, 62, 59, 146, 81, 68, 66, 84, 109, 251,
    235, 127, 84, 100, 63, 107, 68, 99, 185, 164, 23, 185, 194, 195, 150, 67,
    22, 128, 128, 128, 43, 143, 255, 170, 48, 114, 192, 202, 203, 23, 177, 76,
    255, 218, 56, 200, 246, 254, 191, 142, 111, 43, 40, 84, 68, 68, 76, 142,
    66, 66, 92, 68, 73, 143, 215, 29, 135, 196, 26, 121, 176, 24, 110, 140,
    182, 196, 96, 114, 56, 150, 97, 160, 118, 58, 140, 58, 166, 125, 191, 197,
    190, 150, 92, 93, 127, 255, 182, 175, 130, 182, 175, 130, 27, 197, 109, 96,
    197, 27, 36, 36, 36, 142, 66, 66, 238, 85, 70, 121, 110, 97, 191, 142, 111,
    73, 120, 17, 245, 133, 191, 255, 120, 0, 255, 120, 0, 255, 120, 0, 192,
    192, 192, 191, 142, 111, 191, 142, 111, 191, 142, 111, 191, 142, 111, 144,
    148, 144, 13, 88, 130, 213, 229, 237, 253, 221, 3, 191, 142, 111, 255, 162,
    31, 144, 148, 144, 144, 148, 144, 253, 221, 3, 144, 148, 144, 253, 221, 3,
    191, 142, 111, 229, 212, 73, 141, 98, 77, 191, 142, 111, 144, 148, 144,
    191, 142, 111, 11, 80, 143, 91, 169, 169, 78, 193, 227, 48, 186, 135, 128,
    26, 52, 103, 98, 122, 48, 208, 234, 191, 142, 111, 33, 171, 207, 238, 225,
    218, 181, 172, 190, 238, 225, 218, 107, 92, 108, 92, 68, 73, 11, 80, 143,
    91, 169, 169, 106, 107, 118, 73, 51, 36, 141, 175, 255, 159, 209, 229, 128,
    204, 230, 191, 142, 111, 255, 117, 224, 160, 160, 160, 52, 52, 52, 144,
    148, 144, 231, 53, 56, 166, 187, 153, 253, 114, 114, 213, 203, 204, 144,
    148, 144, 96, 96, 96, 191, 142, 111, 98, 95, 167, 192, 59, 59, 144, 148,
    144, 144, 148, 144, 144, 148, 144, 192, 30, 30, 43, 192, 30, 211, 236, 241,
    181, 211, 210, 220, 50, 50, 128, 26, 52, 190, 171, 94, 128, 133, 184, 239,
    141, 126, 190, 171, 94, 131, 162, 161, 170, 171, 157, 104, 100, 126, 145,
    81, 85, 148, 133, 98, 0, 0, 200, 144, 195, 232, 184, 219, 240, 174, 145,
    214, 218, 182, 204, 100, 100, 100, 129, 125, 93, 62, 82, 114, 132, 157,
    127, 152, 171, 198, 228, 219, 162, 33, 135, 85, 181, 194, 217, 253, 221, 3,
    253, 221, 3, 129, 125, 93, 132, 157, 127, 152, 171, 198, 255, 0, 255, 49,
    134, 114, 126, 134, 49, 134, 59, 49, 43, 86, 140, 121, 49, 134, 100, 100,
    100, 149, 149, 115, 255, 0, 255, 255, 0, 255, 73, 120, 17, 223, 255, 255,
    182, 175, 130, 151, 107, 75, 26, 196, 84, 56, 121, 255, 157, 157, 107, 134,
    22, 34, 147, 144, 178, 97, 200, 225, 62, 61, 52, 208, 80, 80, 216, 152,
    144, 203, 61, 64, 213, 178, 28, 128, 44, 45, 125, 55, 65, 186, 50, 52, 124,
    175, 201, 144, 148, 144, 88, 105, 118, 144, 148, 144, 192, 59, 59, 191,
    233, 115, 144, 148, 144, 137, 120, 67, 103, 103, 103, 254, 121, 2, 191,
    142, 111, 144, 148, 144, 144, 148, 144, 144, 148, 144, 144, 148, 144, 239,
    90, 50, 231, 96, 228, 57, 85, 101, 107, 132, 139, 227, 125, 22, 141, 56, 0,
    255, 255, 255, 144, 148, 144, 255, 156, 12, 131, 79, 13, 224, 194, 101,
    145, 81, 85, 255, 0, 255, 53, 44, 41, 214, 184, 46, 149, 232, 87, 255, 241,
    51, 225, 128, 206, 224, 194, 101, 99, 50, 30, 77, 74, 72, 99, 50, 30, 140,
    179, 254, 200, 245, 253, 99, 50, 30, 99, 50, 30, 140, 150, 150, 219, 71,
    38, 249, 52, 243, 76, 74, 83, 235, 150, 23, 153, 131, 44, 57, 48, 97, 248,
    158, 92, 107, 49, 154, 154, 148, 49, 49, 49, 154, 49, 154, 68, 154, 49, 77,
    85, 89, 118, 154, 83, 49, 221, 79, 255, 250, 255, 79, 79, 102, 255, 79,
    255, 89, 255, 79, 79, 240, 240, 247, 255, 145, 79, 191, 142, 111, 122, 217,
    232, 122, 217, 232, 121, 119, 101, 128, 128, 128, 190, 171, 94, 122, 217,
    232, 122, 217, 232, 122, 217, 232, 122, 217, 232, 122, 217, 232, 122, 217,
    232, 122, 217, 232, 122, 217, 232, 128, 128, 128, 150, 67, 22, 122, 217,
    232, 122, 217, 232, 79, 128, 17, 122, 217, 232, 122, 217, 232, 122, 217,
    232, 122, 217, 232, 122, 217, 232, 122, 217, 232, 122, 217, 232, 122, 217,
    232, 122, 217, 232, 122, 217, 232, 122, 217, 232, 122, 217, 232, 144, 148,
    144, 144, 148, 144, 144, 148, 144, 144, 148, 144, 144, 148, 144, 144, 148,
    144, 144, 148, 144, 144, 148, 144, 144, 148, 144, 122, 217, 232, 122, 217,
    232, 117, 61, 25, 204, 93, 73, 87, 150, 154, 181, 164, 125, 235, 114, 80,
    122, 217, 232, 122, 217, 232, 122, 217, 232, 96, 68, 48, 203, 185, 151, 96,
    77, 64, 198, 170, 104, 182, 141, 86, 228, 213, 173, 129, 125, 93, 9, 61,
    191, 253, 32, 3, 200, 246, 254, 15, 15, 15, 226, 118, 76, 161, 172, 173,
    204, 181, 72, 190, 190, 178, 191, 142, 111, 217, 174, 137, 253, 62, 3, 144,
    148, 144, 85, 255, 160, 122, 217, 232, 96, 248, 2, 105, 74, 202, 29, 240,
    255, 254, 202, 80, 131, 252, 245, 255, 156, 12, 149, 212, 89, 236, 74, 79,
    44, 26, 233, 144, 148, 144, 55, 97, 155, 31, 31, 31, 238, 97, 94, 28, 216,
    94, 141, 107, 89, 141, 107, 89, 233, 203, 24, 168, 178, 204, 122, 217, 232,
    122, 217, 232, 122, 217, 232, 122, 217, 232, 122, 217, 232, 122, 217, 232,
    122, 217, 232, 146, 136, 205, 223, 232, 233, 168, 178, 204, 50, 46, 104,
    50, 46, 104, 127, 116, 194, 249, 101, 189, 252, 128, 201, 9, 61, 191, 253,
    32, 3, 255, 156, 12, 160, 120, 92, 191, 142, 111, 160, 120, 100, 251, 209,
    240, 191, 142, 111, 254, 121, 2, 28, 216, 94, 221, 136, 144, 131, 206, 12,
    87, 21, 144, 127, 92, 69, 127, 92, 69, 127, 92, 69, 127, 92, 69, 253, 32,
    3, 122, 217, 232, 122, 217, 232, 122, 217, 232, 122, 217, 232, 191, 142,
    111, 198, 124, 78, 212, 192, 100, 100, 82, 126, 77, 76, 66, 96, 68, 117,
    68, 60, 51, 174, 168, 186, 205, 152, 186, 140, 84, 60, 140, 140, 140, 120,
    120, 120, 255, 227, 132, 85, 83, 82, 85, 83, 82, 75, 139, 166, 227, 46, 46,
    75, 139, 166, 122, 217, 232, 122, 217, 232, 249, 75, 7, 0, 160, 170, 160,
    87, 234, 22, 173, 254, 117, 125, 151, 255, 255, 255, 73, 70, 70, 73, 70,
    70, 255, 255, 255, 146, 155, 187, 174, 195, 215, 77, 11, 35, 119, 22, 52,
    255, 255, 255, 63, 63, 63, 23, 119, 79, 23, 54, 119, 119, 68, 23, 74, 23,
    119, 78, 82, 109, 39, 168, 96, 39, 94, 168, 168, 121, 39, 111, 39, 168,
    150, 148, 174, 255, 255, 255, 255, 255, 255, 3, 144, 201, 123, 123, 123,
    191, 176, 124, 55, 55, 73, 255, 66, 152, 179, 132, 255, 0, 206, 180, 91,
    186, 240, 92, 240, 91, 240, 91, 147, 255, 150, 181, 255, 255, 255, 174, 16,
    176, 48, 255, 110, 179, 132, 255, 255, 255, 255, 211, 198, 111, 190, 223,
    232, 141, 163, 181, 255, 222, 100, 231, 178, 28, 155, 214, 240, 233, 183,
    128, 51, 84, 195, 205, 153, 73, 233, 207, 94, 255, 255, 255, 191, 142, 111,
    123, 91, 68, 111, 81, 58, 141, 121, 111, 66, 80, 94, 117, 94, 96, 107, 79,
    59, 133, 144, 154, 96, 112, 68, 165, 85, 87, 188, 115, 71, 130, 124, 127,
    56, 62, 80, 62, 77, 71, 122, 64, 95, 115, 126, 61, 161, 121, 86, 122, 119,
    92, 141, 90, 87, 114, 101, 79, 84, 90, 131, 128, 135, 137, 129, 73, 177,
    104, 108, 99, 136, 85, 161, 165, 164, 182, 175, 151, 110, 101, 90, 84, 53,
    109, 64, 142, 97, 77, 143, 148, 117, 123, 70, 62, 107, 103, 114, 121, 149,
    171, 188, 140, 83, 92, 75, 118, 115, 137, 140, 41, 28, 19, 102, 80, 61, 31,
    56, 98, 54, 54, 58, 115, 83, 60, 135, 94, 99, 83, 112, 105, 108, 110, 87,
    126, 112, 99, 76, 100, 112, 106, 82, 120, 161, 112, 79, 108, 95, 132, 127,
    127, 153, 135, 146, 156, 73, 106, 110, 73, 114, 125, 71, 120, 116, 94, 113,
    103, 87, 104, 112, 81, 109, 95, 98, 124, 90, 130, 126, 93, 103, 88, 116,
    91, 84, 108, 107, 107, 107, 89, 117, 110, 105, 116, 118, 129, 160, 95, 104,
    144, 78, 88, 148, 152, 65, 131, 141, 85, 95, 96, 154, 99, 135, 142, 75,
    124, 50, 107, 197, 106, 120, 103, 80, 157, 183, 101, 125, 96, 174, 76, 103,
    135, 105, 94, 80, 93, 33, 134, 96, 54, 56, 88, 6, 71, 107, 101, 66, 115,
    95, 136, 128, 66, 97, 107, 100, 111, 129, 123, 73, 123, 144, 106, 136, 111,
    98, 72, 64, 101, 127, 137, 113, 146, 126, 144, 127, 59, 110, 116, 130, 115,
    122, 45, 115, 122, 45, 87, 92, 112, 98, 129, 149, 168, 138, 100, 147, 131,
    129, 126, 136, 160, 119, 152, 164, 117, 148, 167, 99, 128, 23, 130, 121,
    149, 94, 71, 54, 68, 55, 47, 96, 57, 60, 36, 38, 89, 136, 86, 53, 87, 83,
    64, 85, 125, 100, 110, 93, 93, 116, 113, 121, 106, 103, 105, 113, 113, 113,
    113, 113, 113, 113, 113, 113, 113, 113, 113, 113, 113, 113, 113, 113, 113,
    113, 113, 113, 142, 113, 79, 145, 84, 56, 165, 115, 69, 104, 76, 67, 116,
    85, 64, 147, 94, 104, 110, 91, 77, 120, 127, 75, 146, 114, 111, 120, 134,
    161, 123, 142, 133, 99, 139, 156, 98, 143, 144, 123, 131, 138, 115, 144,
    159, 122, 139, 132, 127, 140, 165, 131, 149, 135, 107, 147, 165, 109, 153,
    144, 132, 136, 140, 115, 147, 158, 131, 140, 130, 136, 93, 52, 114, 77, 49,
    150, 108, 74, 133, 79, 77, 126, 108, 44, 130, 130, 130, 85, 115, 129, 72,
    85, 99, 142, 106, 103, 145, 141, 106, 178, 145, 158, 188, 85, 67, 144, 96,
    148, 134, 89, 141, 150, 150, 150, 133, 133, 133, 76, 108, 96, 85, 94, 54,
    68, 157, 182, 109, 123, 113, 102, 71, 74, 125, 84, 83, 95, 82, 92, 116,
    108, 163, 136, 67, 56, 132, 74, 60, 83, 87, 161, 103, 132, 120, 205, 121,
    135, 110, 139, 129, 118, 122, 110, 117, 125, 103, 106, 125, 110, 84, 84,
    77, 130, 130, 104, 95, 122, 64, 92, 92, 92, 100, 100, 100, 87, 136, 7, 74,
    129, 10, 83, 56, 48, 143, 103, 104, 168, 83, 134, 57, 149, 179, 61, 63, 75,
    171, 141, 206, 199, 201, 203, 95, 104, 142, 93, 79, 103, 128, 84, 107, 84,
    96, 134, 187, 93, 156, 149, 66, 92, 118, 65, 43, 196, 208, 218, 145, 103,
    77, 141, 134, 150, 114, 132, 148, 79, 136, 176, 131, 134, 114, 89, 145,
    166, 140, 147, 149, 124, 132, 168, 121, 128, 149, 84, 86, 161, 65, 133, 53,
    129, 50, 96, 155, 139, 67, 121, 133, 135, 158, 97, 65, 74, 70, 119, 145,
    75, 67, 35, 94, 127, 113, 137, 98, 144, 37, 5, 129, 14, 93, 28, 124, 62,
    11, 95, 131, 80, 17, 107, 67, 67, 67
};

uint8_t wallColors[] = {
    0, 0, 0, 53, 53, 53, 87, 60, 48, 47, 41, 53, 69, 50, 37, 59, 59, 59, 76,
    44, 41, 46, 50, 67, 49, 61, 61, 75, 46, 70, 107, 91, 34, 79, 85, 86, 101,
    57, 25, 77, 48, 43, 12, 12, 12, 49, 43, 44, 81, 63, 54, 46, 50, 67, 49, 61,
    61, 75, 46, 70, 12, 12, 12, 54, 89, 98, 97, 92, 94, 56, 44, 58, 49, 40, 42,
    18, 66, 98, 34, 64, 54, 58, 48, 42, 77, 70, 81, 112, 58, 68, 56, 115, 80,
    94, 101, 108, 102, 20, 48, 48, 48, 73, 86, 83, 57, 54, 59, 82, 124, 70, 63,
    89, 84, 55, 60, 90, 70, 89, 89, 84, 100, 118, 129, 57, 55, 64, 62, 25, 27,
    60, 55, 44, 51, 51, 51, 65, 63, 57, 68, 83, 69, 66, 70, 82, 78, 69, 83, 81,
    74, 63, 56, 66, 81, 50, 73, 59, 82, 59, 64, 70, 79, 81, 46, 58, 54, 56, 56,
    46, 57, 49, 49, 45, 51, 56, 56, 48, 59, 80, 63, 55, 0, 49, 17, 55, 40, 28,
    32, 28, 22, 25, 67, 38, 47, 67, 25, 25, 67, 38, 25, 67, 38, 47, 67, 25, 25,
    67, 38, 36, 37, 57, 25, 61, 67, 82, 108, 134, 45, 84, 24, 211, 217, 219,
    54, 60, 113, 61, 61, 44, 26, 51, 111, 75, 18, 22, 58, 35, 24, 36, 33, 65,
    54, 60, 113, 101, 52, 52, 56, 19, 0, 62, 44, 45, 78, 105, 131, 32, 39, 45,
    121, 80, 36, 28, 8, 10, 115, 68, 124, 129, 114, 74, 62, 86, 123, 90, 121,
    94, 135, 62, 61, 100, 96, 103, 36, 48, 57, 48, 46, 58, 71, 46, 73, 76, 46,
    64, 51, 63, 57, 49, 58, 64, 36, 48, 57, 48, 46, 58, 71, 46, 73, 76, 46, 64,
    51, 63, 57, 49, 58, 64, 97, 72, 51, 53, 53, 53, 121, 80, 36, 110, 37, 19,
    135, 57, 137, 33, 25, 21, 28, 8, 10, 160, 75, 7, 54, 42, 19, 42, 30, 53,
    60, 34, 25, 91, 83, 64, 59, 61, 54, 47, 39, 25, 80, 88, 111, 186, 167, 138,
    110, 119, 143, 138, 128, 110, 7, 48, 30, 78, 103, 70, 109, 111, 123, 112,
    166, 226, 69, 56, 140, 72, 44, 145, 114, 85, 121, 104, 119, 158, 74, 74,
    74, 95, 119, 191, 144, 79, 22, 62, 130, 138, 61, 98, 169, 183, 84, 14, 61,
    57, 69, 74, 32, 34, 110, 100, 76, 66, 70, 60, 214, 206, 187, 83, 106, 99,
    89, 67, 68, 120, 120, 120, 103, 55, 24, 77, 77, 77, 229, 218, 161, 82, 70,
    65, 81, 69, 62, 103, 76, 36, 103, 76, 36, 255, 116, 63, 191, 63, 255, 219,
    219, 232, 63, 255, 71, 118, 63, 37, 81, 37, 118, 64, 67, 89, 37, 118, 52,
    118, 37, 58, 37, 37, 118, 118, 113, 37, 255, 63, 63, 63, 81, 255, 239, 255,
    63, 78, 77, 58, 84, 97, 84, 92, 105, 90, 93, 68, 47, 84, 60, 39, 168, 125,
    0, 49, 105, 25, 69, 48, 54, 33, 50, 188, 75, 128, 148, 72, 50, 46, 120,
    127, 143, 124, 131, 148, 15, 16, 45, 31, 31, 74, 57, 55, 99, 120, 127, 143,
    15, 16, 45, 61, 61, 61, 55, 23, 100, 126, 68, 43, 63, 47, 63, 65, 51, 77,
    67, 72, 59, 60, 38, 67, 123, 56, 47, 87, 24, 26, 102, 64, 53, 122, 46, 54,
    99, 70, 55, 102, 73, 57, 92, 65, 49, 106, 75, 58, 81, 33, 83, 96, 79, 99,
    124, 42, 104, 111, 54, 112, 75, 68, 55, 83, 83, 59, 39, 67, 44, 77, 77, 55,
    92, 36, 28, 96, 48, 39, 108, 44, 26, 106, 42, 38, 70, 69, 61, 57, 60, 57,
    69, 57, 59, 71, 60, 66, 148, 93, 52, 51, 38, 65, 43, 24, 22, 78, 73, 114,
    54, 36, 68, 73, 18, 12, 58, 47, 81, 115, 65, 34, 103, 112, 104, 76, 71, 56,
    133, 124, 66, 83, 101, 112, 139, 0, 64, 80, 12, 162, 0, 93, 81, 81, 68, 62,
    37, 47, 57, 72, 53, 55, 103, 46, 48, 126, 68, 43, 63, 35, 34, 57, 34, 33,
    45, 46, 54, 43, 52, 56, 62, 45, 33, 146, 95, 53, 78, 69, 55, 23, 52, 86,
    58, 35, 24, 74, 74, 74, 47, 41, 53, 49, 43, 44, 77, 70, 81, 100, 118, 129,
    78, 69, 83, 81, 74, 63, 56, 66, 81, 50, 73, 59, 82, 59, 64, 70, 79, 81, 46,
    58, 54, 56, 56, 46, 57, 49, 49, 45, 51, 56, 56, 48, 59, 80, 63, 55, 55, 40,
    28, 32, 28, 22, 36, 37, 57, 25, 61, 67, 82, 108, 134, 36, 33, 65, 101, 52,
    52, 62, 44, 45, 93, 68, 47, 84, 60, 39, 120, 127, 143, 15, 16, 45, 61, 61,
    61, 126, 68, 43, 63, 47, 63, 65, 51, 77, 67, 72, 59, 60, 38, 67, 123, 56,
    47, 87, 24, 26, 102, 64, 53, 122, 46, 54, 99, 70, 55, 102, 73, 57, 92, 65,
    49, 106, 75, 58, 81, 33, 83, 96, 79, 99, 124, 42, 104, 111, 54, 112, 75,
    68, 55, 83, 83, 59, 39, 67, 44, 77, 77, 55, 92, 36, 28, 96, 48, 39, 108,
    44, 26, 106, 42, 38, 70, 69, 61, 57, 60, 57, 69, 57, 59, 71, 60, 66, 148,
    93, 52, 51, 38, 65, 43, 24, 22, 78, 73, 114, 54, 36, 68, 73, 18, 12, 58,
    47, 81, 115, 65, 34, 36, 65, 16, 33, 61, 19, 74, 58, 44, 114, 120, 45, 58,
    52, 64, 80, 70, 82, 6, 6, 34, 91, 48, 82, 66, 39, 27, 62, 83, 108, 58, 84,
    115, 99, 94, 105, 80, 92, 104, 56, 95, 124, 92, 94, 80, 62, 102, 116, 98,
    103, 105, 87, 92, 118, 84, 89, 105, 42, 44, 81, 34, 66, 26, 64, 25, 49, 76,
    66, 32, 60, 65, 67, 76, 45, 32, 37, 36, 59, 57, 34, 32, 19, 43, 60, 42, 67,
    60, 104, 23, 0, 91, 9, 65, 17, 89, 43, 5, 65, 94, 58, 6, 81, 255, 0, 255
};

uint8_t paintColors[] = {
    0, 0, 0, 255, 0, 0, 255, 127, 0, 255, 255, 0, 127, 255, 0, 0, 255, 0, 0,
    255, 127, 0, 255, 255, 0, 127, 255, 0, 0, 255, 127, 0, 255, 255, 0, 255,
    255, 0, 127, 255, 0, 0, 255, 127, 0, 255, 255, 0, 127, 255, 0, 0, 255, 0,
    0, 255, 127, 0, 255, 255, 0, 127, 255, 0, 0, 255, 127, 0, 255, 255, 0, 255,
    255, 0, 127, 75, 75, 75, 255, 255, 255, 175, 175, 175, 255, 178, 125, 25,
    25, 25, 255, 255, 255, 255, 255, 255
};
// clang-format on

uint8_t waterColor[] = {0, 12, 255};
uint8_t lavaColor[] = {255, 30, 0};
uint8_t honeyColor[] = {255, 172, 0};
uint8_t shimmerColor[] = {155, 112, 233};

uint8_t surfaceColor[] = {155, 209, 255};
uint8_t undergroundColor[] = {84, 57, 42};
uint8_t cavernColor[] = {72, 64, 57};
uint8_t underworldColor[] = {51, 0, 0};

uint8_t colorBuffer[] = {0, 0, 0};
} // namespace

const uint8_t *getRawTileColor(int x, int y, World &world)
{
    Tile &tile = world.getTile(x, y);
    if (tile.blockID != TileID::empty && !tile.echoCoatBlock) {
        return tileColors + 3 * tile.blockID;
    }
    switch (tile.liquid) {
    case Liquid::water:
        return waterColor;
    case Liquid::lava:
        return lavaColor;
    case Liquid::honey:
        return honeyColor;
    case Liquid::shimmer:
        return shimmerColor;
    default:
        break;
    }
    if (tile.wallID != WallID::empty && !tile.echoCoatWall) {
        return wallColors + 3 * tile.wallID;
    }
    if (y < world.getUndergroundLevel()) {
        return surfaceColor;
    } else if (y < world.getCavernLevel()) {
        return undergroundColor;
    } else if (y < world.getUnderworldLevel()) {
        return cavernColor;
    } else {
        return underworldColor;
    }
}

void blendColor(uint8_t r, uint8_t g, uint8_t b)
{
    colorBuffer[0] = 0.7 * colorBuffer[0] + 0.3 * r;
    colorBuffer[1] = 0.7 * colorBuffer[1] + 0.3 * g;
    colorBuffer[2] = 0.7 * colorBuffer[1] + 0.3 * b;
}

void applyPaint(int paint)
{
    if (paint == Paint::none) {
        return;
    }
    const uint8_t *color = paintColors + 3 * paint;
    blendColor(color[0], color[1], color[2]);
}

const uint8_t *getTileColor(int x, int y, World &world)
{
    std::memcpy(colorBuffer, getRawTileColor(x, y, world), 3);
    Tile &tile = world.getTile(x, y);
    if (tile.blockID != TileID::empty) {
        applyPaint(tile.blockPaint);
    } else if (tile.liquid == Liquid::none && tile.wallID != WallID::empty) {
        applyPaint(tile.wallPaint);
    }
    if (tile.actuated) {
        blendColor(0, 0, 0);
    }
    if (tile.wireRed) {
        blendColor(255, 0, 0);
    }
    if (tile.wireBlue) {
        blendColor(0, 0, 255);
    }
    if (tile.wireGreen) {
        blendColor(0, 255, 0);
    }
    if (tile.wireYellow) {
        blendColor(255, 255, 0);
    }
    return colorBuffer;
}
